(function(){"use strict";var j=[].indexOf||function(e){for(var t=0,a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1};(videojs.registerPlugin||videojs.plugin)("td",function(e){var t,a,l,i,n,s,r,o,d,c,u,h,f,v,g,b,m,_,p;if(e.writeKey&&e.database&&e.table)if((t=document.createElement("a")).href=document.referrer,self===top||"players.brightcove.net"!==window.location.host&&"preview-players.brightcove.net"!==window.location.host||"studio.brightcove.com"!==t.hostname){if(a=this,l=new function(e){this.td=new TreasureVideojs({host:e.host||"in.treasuredata.com",writeKey:e.writeKey,database:e.database,startInSignedMode:e.startInSignedMode||!1}),this.table=e.table,this.debug=e.debug||!1,this.td.set(this.table,{bc_session_id:a.bcAnalytics.client.defaultParams_.session}),e.trackCrossDomain&&this.td.set("$global","td_global_id","td_global_id"),this.log=function(e,t){void 0===t&&(t={}),t.bc_event=e,this.debug?(videojs.log("Table name is "+this.table+", params are as follows."),videojs.log(t)):this.td.trackEvent(this.table,t)}}(e),r=function(e){var t=10;return void 0!==e.interval&&0<=j.call([5,10,25],e.interval)&&(t=e.interval),t}(e),n=["play","pause","error","fullscreen_change","volume_change","ended","percent_of_view","seek","player_load","video_loaded"],0===(i=e.trackEventList||n).length&&(i=n),d=o=0,!(s={}),c={player_load:"Player Loaded",video_loaded:"Contents Loaded",play:"Play",pause:"Pause",error:"Error",fullscreenchange:"FullScreen Start",fullscreenchangeexit:"FullScreen Exit",volumechange:"Volume Change",ended:"Complete",percent_of_view:"Percent of View",seek:"Seek"},e.eventNameLabels&&0<Object.keys(e.eventNameLabels).length)for(var y=Object.keys(e.eventNameLabels),w=y.length,k=0;k<w;k++)c[y[k]]=e.eventNameLabels[y[k]];u=function(){l.td.set(l.table,{bc_video_id:this.mediainfo.id}),l.td.set(l.table,{bc_duration:this.mediainfo.duration}),l.td.set(l.table,{bc_video_name:this.mediainfo.name}),void 0===s[this.mediainfo.id]&&(s[this.mediainfo.id]=[]),l.log(c.video_loaded)},h=function(){l.log(c.ended)},f=function(){l.log(c.play),!1},v=function(){l.log(c.pause),!1},g=function(){l.log(c.error)},b=function(){this.isFullscreen()?l.log(c.fullscreenchange):l.log(c.fullscreenchangeexit)},m=function(){var e;e=!0===this.muted()?0:this.volume(),l.log(c.volumechange,{bc_volume:e})},_=function(){var e,t,a,i,n,o=s[this.mediainfo.id]||(s[this.mediainfo.id]=[],s[this.mediainfo.id]);for(e=Math.round(this.currentTime()),t=Math.round(this.duration()),i=Math.round(e/t*100),a=n=0;n<=100;a=n+=r)a<=i&&j.call(o,a)<0&&(l.log(c.percent_of_view,{bc_percent:a}),o.push(a))},p=function(){var e=Math.round(this.currentTime());o=d,d=e,1<Math.abs(o-d)&&(!0,l.log(c.seek,{bc_seek_start:o,bc_seek_end:d}))},this.ready(function(){0<=j.call(i,"player_load")&&l.log(c.player_load),0<=j.call(i,"video_loaded")&&a.on("loadedmetadata",u),0<=j.call(i,"play")&&a.on("play",f),0<=j.call(i,"pause")&&a.on("pause",v),0<=j.call(i,"error")&&a.on("error",g),0<=j.call(i,"fullscreen_change")&&a.on("fullscreenchange",b),0<=j.call(i,"volume_change")&&a.on("volumechange",m),0<=j.call(i,"percent_of_view")&&a.on("timeupdate",_),0<=j.call(i,"seek")&&a.on("timeupdate",p),0<=j.call(i,"ended")&&a.on("ended",h)})}else videojs.log("TreasureData plugin will not track events in Video Cloud Studio");else videojs.log("require writeKey, database, table")})}).call(this);